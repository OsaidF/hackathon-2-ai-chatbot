# Chatbot Application - Kubernetes Management Commands

## Helm Commands

### Using Helm Directly

Since Helm is at `C:\Program Files\Helm\helm.exe`, you can use these commands:

**PowerShell:**
```powershell
helm install my-chatbot .\helm-chatbot
helm uninstall my-chatbot
helm upgrade my-chatbot .\helm-chatbot
```

**Git Bash:**
```bash
"/c/Program Files/Helm/helm.exe" install my-chatbot ./helm-chatbot
"/c/Program Files/Helm/helm.exe" uninstall my-chatbot
"/c/Program Files/Helm/helm.exe" upgrade my-chatbot ./helm-chatbot
```

### Recommended: Create a Helm Alias

**Add to your ~/.bashrc or ~/.bash_profile:**
```bash
alias helm="/c/Program\ Files/Helm/helm.exe"
```

Then you can use `helm` directly in Git Bash:
```bash
helm install my-chatbot ./helm-chatbot
helm list
helm status my-chatbot
```

### Current Deployment

```bash
helm list
helm status my-chatbot
helm get all my-chatbot
```

## Application Management

### Deploy Application
```bash
helm install my-chatbot ./helm-chatbot
```

### Stop Application
```bash
helm uninstall my-chatbot
```

### Update Application (after changing values.yaml)
```bash
helm upgrade my-chatbot ./helm-chatbot
```

### Rollback to Previous Version
```bash
helm rollback my-chatbot
```

### View Release History
```bash
helm history my-chatbot
```

## Configuration

### Change Values

1. Edit `helm-chatbot/values.yaml`
2. Upgrade the release:
```bash
helm upgrade my-chatbot ./helm-chatbot
```

### Override Values at Install Time

```bash
helm install my-chatbot ./helm-chatbot \
  --set backend.replicas=3 \
  --set frontend.replicas=2 \
  --set secrets.jwtSecretKey="my-secret-key"
```

### Override Values at Upgrade Time

```bash
helm upgrade my-chatbot ./helm-chatbot \
  --set backend.replicas=3 \
  --set frontend.service.type=NodePort
```

## Access URLs

- **Frontend:** http://localhost
- **Backend API:** http://localhost:8000
- **Backend Docs:** http://localhost:8000/docs
- **Backend Health:** http://localhost:8000/health

## Kubernetes Commands

### Check Status
```bash
kubectl get all -l app.kubernetes.io/instance=my-chatbot
kubectl get pods -l app.kubernetes.io/instance=my-chatbot
kubectl get services -l app.kubernetes.io/instance=my-chatbot
```

### View Logs
```bash
# Backend logs
kubectl logs -l app.kubernetes.io/name=chatbot,component=backend -f

# Frontend logs
kubectl logs -l app.kubernetes.io/name=chatbot,component=frontend -f

# Specific pod logs
kubectl logs my-chatbot-backend-xxxxx -f
```

### Restart Services
```bash
kubectl rollout restart deployment my-chatbot-backend
kubectl rollout restart deployment my-chatbot-frontend
```

### Scale Deployments
```bash
kubectl scale deployment my-chatbot-backend --replicas=3
kubectl scale deployment my-chatbot-frontend --replicas=2
```

## Troubleshooting

### Check Pod Status
```bash
kubectl describe pod my-chatbot-backend-xxxxx
kubectl get pods -l app.kubernetes.io/instance=my-chatbot
```

### Check Events
```bash
kubectl get events --sort-by='.lastTimestamp'
```

### Access Pod Shell
```bash
kubectl exec -it my-chatbot-backend-xxxxx -- /bin/sh
kubectl exec -it my-chatbot-frontend-xxxxx -- /bin/sh
```

### Port Forwarding (if services are not accessible)
```bash
# Backend
kubectl port-forward service/my-chatbot-backend-service 8000:8000

# Frontend
kubectl port-forward service/my-chatbot-frontend-service 3000:80
```

## Helm Chart Structure

```
helm-chatbot/
├── Chart.yaml              # Chart metadata
├── values.yaml             # Configuration values
├── README.md               # Documentation
└── templates/
    ├── _helpers.tpl        # Template helpers
    ├── frontend-deployment.yaml
    ├── frontend-service.yaml
    ├── backend-deployment.yaml
    ├── backend-service.yaml
    ├── secrets.yaml
    ├── configmap.yaml
    └── NOTES.txt           # Post-install instructions
```

## Current Release Info

- **Release Name:** my-chatbot
- **Namespace:** default
- **Chart:** chatbot-0.1.0
- **App Version:** 1.0
- **Status:** deployed

**Resources:**
- Frontend Deployment: `my-chatbot-frontend`
- Backend Deployment: `my-chatbot-backend`
- Frontend Service: `my-chatbot-frontend-service` (LoadBalancer, port 80)
- Backend Service: `my-chatbot-backend-service` (LoadBalancer, port 8000)
- ConfigMap: `my-chatbot-chatbot-config`
- Secret: `my-chatbot-chatbot-secrets`

## Useful Helm Tips

### See what would be deployed without actually deploying
```bash
helm install my-chatbot ./helm-chatbot --dry-run --debug
```

### Test the chart
```bash
helm test my-chatbot
```

### Show values used for deployment
```bash
helm get values my-chatbot
```

### Show all manifests generated by Helm
```bash
helm get manifest my-chatbot
```

### Lint the chart
```bash
helm lint ./helm-chatbot
```

### Package the chart
```bash
helm package ./helm-chatbot
```

## Quick Start Guide

1. **First time deployment:**
   ```bash
   helm install my-chatbot ./helm-chatbot
   ```

2. **Check it's running:**
   ```bash
   kubectl get pods
   ```

3. **Access the app:**
   - Frontend: http://localhost
   - Backend API Docs: http://localhost:8000/docs

4. **Make changes:**
   - Edit `helm-chatbot/values.yaml`
   - Run: `helm upgrade my-chatbot ./helm-chatbot`

5. **Stop the app:**
   ```bash
   helm uninstall my-chatbot
   ```
